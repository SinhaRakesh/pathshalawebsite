if("undefined"==typeof jQuery)throw new Error("DCalendar.Picker: This plugin requires jQuery");+function(t){Date.prototype.getDays=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()};var e=["January","February","March","April","May","June","July","August","September","October","November","December"],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=function(a,d){function r(t){var e=new Date(n.date),a=e.getMonth(),d=e.getFullYear();e.setDate(1),"days"===n.viewMode?e.setMonth(a+("next"===t?1:-1)):e.setFullYear(d+("next"===t?1:-1)),n.date=e,n.create(n.viewMode)}this.calendar=t(a),this.today=new Date,this.date=""===this.calendar.prev().val()?new Date:new Date(this.calendar.prev().val()),this.viewMode="days",this.options=d,this.selected=this.date.getMonth()+1+"/"+this.date.getDate()+"/"+this.date.getFullYear(),"calendar"===d.mode?this.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr></thead>'):"datepicker"===d.mode&&(this.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th></tr></thead>')),this.tHead.find("#currM").text(e[this.today.getMonth()]+" "+this.today.getFullYear()),this.calendar.prepend(this.tHead);var n=this;this.calendar.on("click","#next",function(){r("next")}).on("click","#prev",function(){r("prev")}).on("click","#today",function(){n.viewMode="days";var t=new Date(n.date),e=new Date(n.today);t.toString()!=e.toString()&&(n.date=e),n.create("days")}).on("click",".date, .pMDate, .nMDate",function(){var e=t(this).attr("class"),a=t(this).text(),d=n.date.getMonth(),r=n.date.getFullYear();return"pMDate"===e?r=0===d?r-1:r:"nMDate"===e&&(r=d+2===13?r+1:r),"pMDate"===e?d=0===d?"12":d:"nMDate"===e?d=d+2===13?"1":d+2:d+=1,n.selected=d+"/"+a+"/"+r,"datepicker"===n.options.mode&&(n.calendar.find("td").removeClass("selected"),t(this).addClass("selected")),n.selectDate(),!0}).on("click","#currM",function(){n.viewMode="months",n.create(n.viewMode)}).on("click",".month",function(e){n.viewMode="days";{var a=new Date(n.date);n.calendar.find("#currM").text()}a.setMonth(t(e.currentTarget).attr("num")),n.date=a,n.create(n.viewMode)}),this.create(this.viewMode)};r.prototype={constructor:r,setDate:function(){var t=this,e=t.reformatDate(t.calendar.prev().val()),a=isNaN(parseInt(e.m))?new Date(e.m+" "+e.d+", "+e.y):new Date(e.y,e.m-1,e.d);t.selected=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear(),t.selectDate(),t.date=a,t.create(t.viewMode)},selectDate:function(){var e=this,a=e.formatDate(e.options.format),d=t.Event("selectdate",{date:a});e.calendar.trigger(d)},reformatDate:function(t){var e=this,a=e.options.format;return{m:t.substring(a.indexOf("m"),a.lastIndexOf("m")+1),d:t.substring(a.indexOf("d"),a.lastIndexOf("d")+1),y:t.substring(a.indexOf("y"),a.lastIndexOf("y")+1)}},formatDate:function(t){console.log(this.selected);var d=this,r=new Date(d.selected),n=r.getDate(),o=r.getMonth(),s=r.getFullYear();return t.replace(/(yyyy|yy|mmmm|mmm|mm|m|dd|d)/gi,function(t){switch(t.toLowerCase()){case"d":return n;case"dd":return 10>n?"0"+n:n;case"m":return o+1;case"mm":return 10>o+1?"0"+(o+1):o+1;case"mmm":return a[o];case"mmmm":return e[o];case"yy":return s.toString().substr(2,2);case"yyyy":return s}})},create:function(r){var n=this,o=[],s=t("<tbody></tbody>"),h=new Date(n.date),i=n.date.getDays(),c=1,l=1,u=n.selected.split("/");if(n.calendar.empty(),"days"===r){"calendar"===n.options.mode?n.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead>'):"datepicker"===n.options.mode&&(n.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="5" id="currM"></th><th id="next">&rsaquo;</th></tr><tr><th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th></tr></thead>')),n.tHead.find("#currM").text(e[n.date.getMonth()]+" "+n.date.getFullYear()),n.calendar.append(n.tHead);for(var p=1;6>=p;p++){for(var y=[t("<td></td>"),t("<td></td>"),t("<td></td>"),t("<td></td>"),t("<td></td>"),t("<td></td>"),t("<td></td>")];i>=c;){h.setDate(c);var f=h.getDay();if(c===n.today.getDate()&&h.getMonth()===n.today.getMonth()&&h.getFullYear()===n.today.getFullYear()&&y[f].attr("id","currDay"),"datepicker"===n.options.mode&&h.getMonth()+1+"/"+c+"/"+h.getFullYear()==u[0]+"/"+u[1]+"/"+u[2]&&y[f].addClass("selected"),1===p&&0===f)break;if(!(6>f)){y[f].html("<span>"+c++ +"</span>").addClass("date");break}y[f].html("<span>"+c++ +"</span>").addClass("date")}if(1===p||p>4){var g=new Date(n.date);if(1===p){var m=g.getMonth(),v=0;g.setDate(1),g.setMonth(m-1),v=g.getDays();for(var M=6;M>=0;M--)""===y[M].text()&&(y[M].html("<span>"+v--+"</span>").addClass("pMDate"),"datepicker"===n.options.mode&&h.getMonth()+"/"+(v+1)+"/"+h.getFullYear()==u[0]+"/"+u[1]+"/"+u[2]&&y[M].addClass("selected"))}else if(p>4)for(var M=0;6>=M;M++)""===y[M].text()&&(y[M].html("<span>"+l++ +"</span>").addClass("nMDate"),"datepicker"===n.options.mode&&h.getMonth()+2+"/"+(l-1)+"/"+h.getFullYear()==u[0]+"/"+u[1]+"/"+u[2]&&y[M].addClass("selected"))}o.push(y)}t.each(o,function(e,a){for(var d=t("<tr></tr>"),r=a.length,e=0;r>e;e++)d.append(a[e]);s.append(d)});var D="Today: "+d[n.today.getDay()]+", "+e[n.today.getMonth()]+" "+n.today.getDate()+", "+n.today.getFullYear();s.append('<tr><td colspan="7" id="today">'+D+"</td></tr>").appendTo(n.calendar)}else{this.tHead=t('<thead><tr><th id="prev">&lsaquo;</th><th colspan="2" id="currM"></th><th id="next">&rsaquo;</th></tr>'),n.tHead.find("#currM").text(n.date.getFullYear()),n.tHead.appendTo(n.calendar);for(var w=0,p=0;3>p;p++){for(var x=t("<tr></tr>"),F=0;4>F;F++){var k=t('<td align="center"></td>'),b=t('<span class="month" num="'+w+'">'+a[w]+"</span>");k.append(b).appendTo(x),w++}s.append(x)}var D="Today: "+d[n.today.getDay()]+", "+e[n.today.getMonth()]+" "+n.today.getDate()+", "+n.today.getFullYear();s.append('<tr><td colspan="4" id="today">'+D+"</td></tr>").appendTo(n.calendar)}}},t.fn.dcalendar=function(e){return t(this).each(function(){var a=this,d=t(a),n=t(a).data("dcalendar"),o=t.extend({},t.fn.dcalendar.defaults,d.data(),"object"==typeof e&&e);n||d.data("dcalendar",n=new r(this,o)),"string"==typeof e&&n[e]()})},t.fn.dcalendar.defaults={mode:"calendar",format:"mm/dd/yyyy"},t.fn.dcalendar.Constructor=r,t.fn.dcalendarpicker=function(e){return t(this).each(function(){var a=t(this),d=!1,r=!1,n=null;if("string"==typeof e){var o=a.next(".calendar").data("dcalendar");o[e]()}else n=t('<table class="calendar"></table>'),a.wrap(t('<div class="datepicker" style="display:inline-block;position:relative;"></div>')),n.css({position:"absolute",left:0,display:"none","box-shadow":"0 4px 6px 1px rgba(0, 0, 0, 0.14)",width:"230px"}).appendTo(a.parent()),e?(e.mode="datepicker",n.dcalendar(e)):n.dcalendar({mode:"datepicker"}),n.hover(function(){d=!0},function(){d=!1}).on("click",function(){r?(r=!1,t(this).hide()):a.focus()}).on("selectdate",function(e){a.val(e.date).trigger("onchange"),a.trigger(t.Event("dateselected",{date:e.date,elem:a})),r=!0}),a.on("keydown",function(t){return t.which?!1:void 0}).on("focus",function(){t(".datepicker").find(".calendar").not(n).hide(),n.show()}).on("blur",function(){d||n.hide()})})}}(jQuery);